<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Armonía Bloqueada: El Tetris de la Tensión Musical</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        
        body {
            background-color: #121212;
            color: #E0E0E0;
            font-family: 'Orbitron', sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
        }

        #game-container {
            display: flex;
            gap: 24px;
            max-width: 1200px;
            width: 100%;
            flex-wrap: wrap;
            justify-content: center;
        }

        #canvas-wrapper {
            background-color: #000000;
            border: 8px solid #3A3A3A;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.5);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }

        #game-canvas {
            display: block;
            border-radius: 4px;
        }

        #info-panel {
            min-width: 250px;
            background-color: #1F1F1F;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .info-card {
            background-color: #2D2D2D;
            padding: 12px;
            border-radius: 8px;
            border-left: 5px solid #00FFD5;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .info-card h3 {
            font-weight: 700;
            color: #00FFD5;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        .info-card p {
            font-size: 1.5rem;
            color: #FFFFFF;
        }

        /* Next Piece Display */
        #next-piece-display {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 1px;
            width: 80px;
            height: 80px;
            margin: 10px auto;
            background-color: #000000;
            border: 2px solid #555;
            border-radius: 4px;
        }
        .next-block {
            background-color: transparent;
        }

        /* Botones de control (ocultos en escritorio) */
        .controls {
            display: none;
            width: 100%;
            justify-content: center;
            margin-top: 20px;
            gap: 10px;
        }

        .control-btn {
            background-color: #00FFD5;
            color: #121212;
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 0 #00A38B;
            transition: all 0.1s;
            flex: 1;
            max-width: 150px;
        }

        .control-btn:active {
            box-shadow: 0 1px 0 #00A38B;
            transform: translateY(3px);
        }

        /* Estilos del Modal del Quiz */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #1F1F1F;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.7);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-content h2 {
            font-size: 1.8rem;
            color: #FFD500;
            margin-bottom: 20px;
            text-shadow: 1px 1px 5px rgba(255, 213, 0, 0.5);
        }

        .modal-content p {
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #3A3A3A;
            color: #FFFFFF;
            border: 2px solid #555;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.15s, border-color 0.15s, transform 0.1s;
        }

        .option-btn:hover {
            background-color: #555;
            border-color: #00FFD5;
        }
        
        .option-btn.selected {
            background-color: #00FFD5;
            color: #121212;
            font-weight: 700;
            border-color: #00FFD5;
        }

        .quiz-submit-btn {
            margin-top: 20px;
            background-color: #FFD500;
            color: #121212;
            padding: 15px 30px;
            font-weight: 700;
            border-radius: 8px;
            box-shadow: 0 4px 0 #CCAA00;
        }

        .quiz-submit-btn:active {
            box-shadow: 0 1px 0 #CCAA00;
            transform: translateY(3px);
        }

        /* Media Queries para responsividad */
        @media (max-width: 768px) {
            #game-container {
                flex-direction: column;
                align-items: center;
            }

            #info-panel {
                width: 100%;
                max-width: 400px;
                order: -1;
            }

            .controls {
                display: flex;
            }
        }
    </style>
</head>
<body>

    <div id="game-container">
        
        <!-- Panel de Información -->
        <div id="info-panel">
            <h1 class="text-2xl text-center font-bold text-teal-400 mb-4">Armonía Bloqueada</h1>
            
            <div class="info-card">
                <h3>Puntuación</h3>
                <p id="score">0</p>
            </div>
            
            <div class="info-card">
                <h3>Líneas</h3>
                <p id="lines">0</p>
            </div>
            
            <div class="info-card">
                <h3>Desafío de Tensión</h3>
                <p id="challenge-progress">0 / 500</p>
            </div>

            <div class="info-card">
                <h3>Siguiente Pieza</h3>
                <div id="next-piece-display"></div>
            </div>

            <button id="start-button" class="mt-4 bg-lime-500 hover:bg-lime-600 text-black font-bold py-3 px-6 rounded-lg transition duration-200">
                INICIAR JUEGO (ENTER)
            </button>
        </div>

        <!-- Área de Juego -->
        <div id="canvas-wrapper">
            <canvas id="game-canvas" width="300" height="600"></canvas>
        </div>

        <!-- Controles Móviles -->
        <div class="controls md:hidden">
            <button class="control-btn" data-action="left">Izquierda</button>
            <button class="control-btn" data-action="down">Abajo</button>
            <button class="control-btn" data-action="rotate">Rotar</button>
            <button class="control-btn" data-action="right">Derecha</button>
        </div>
        
    </div>

    <!-- Modal del Desafío de Tensión (Quiz) -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <h2>¡DESAFÍO DE TENSIÓN!</h2>
            <p id="quiz-question"></p>
            <div id="quiz-options" class="mb-4">
                <!-- Opciones se inyectan aquí -->
            </div>
            <button id="quiz-submit" class="quiz-submit-btn hover:bg-yellow-400">RESPONDER</button>
        </div>
    </div>

    <script>
        // --- CONSTANTES DEL JUEGO ---
        const COLS = 10;
        const ROWS = 20;
        const BLOCK_SIZE = 30;
        const BOARD_WIDTH = COLS * BLOCK_SIZE;
        const BOARD_HEIGHT = ROWS * BLOCK_SIZE;
        const INITIAL_SPEED = 1000; // ms

        // --- SETUP CANVAS ---
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = BOARD_WIDTH;
        canvas.height = BOARD_HEIGHT;
        ctx.scale(1, 1);

        // --- ESTADO DEL JUEGO ---
        let board = Array(ROWS).fill(null).map(() => Array(COLS).fill(0)); // 0: vacío
        let currentPiece = null;
        let nextPiece = null;
        let score = 0;
        let lines = 0;
        let isPlaying = false;
        let dropCounter = 0;
        let dropInterval = INITIAL_SPEED;
        let lastTime = 0;
        let challengeGoal = 500;
        let isQuizActive = false;

        // --- ELEMENTOS DEL DOM ---
        const scoreElement = document.getElementById('score');
        const linesElement = document.getElementById('lines');
        const challengeProgressElement = document.getElementById('challenge-progress');
        const startButton = document.getElementById('start-button');
        const nextPieceDisplay = document.getElementById('next-piece-display');
        const quizModal = document.getElementById('quiz-modal');
        const quizQuestionElement = document.getElementById('quiz-question');
        const quizOptionsElement = document.getElementById('quiz-options');
        const quizSubmitButton = document.getElementById('quiz-submit');

        // --- DEFINICIÓN DE PIEZAS Y COLORES (Basado en el círculo de quintas para un toque musical) ---
        const PIECES = [
            // I (Do)
            [[0, 0, 0, 0], [1, 1, 1, 1], [0, 0, 0, 0], [0, 0, 0, 0]],
            // J (Sol)
            [[2, 0, 0], [2, 2, 2], [0, 0, 0]],
            // L (Re)
            [[0, 0, 3], [3, 3, 3], [0, 0, 0]],
            // O (La)
            [[4, 4], [4, 4]],
            // S (Mi)
            [[0, 5, 5], [5, 5, 0], [0, 0, 0]],
            // T (Si)
            [[0, 6, 0], [6, 6, 6], [0, 0, 0]],
            // Z (Fa)
            [[7, 7, 0], [0, 7, 7], [0, 0, 0]]
        ];

        const COLORS = [
            '#000000', // 0: Fondo (Negro)
            '#00FFFF', // 1: I - Cyan (Do)
            '#0000FF', // 2: J - Azul (Sol)
            '#FF7F00', // 3: L - Naranja (Re)
            '#FFFF00', // 4: O - Amarillo (La)
            '#00FF00', // 5: S - Verde (Mi)
            '#800080', // 6: T - Púrpura (Si)
            '#FF0000'  // 7: Z - Rojo (Fa)
        ];

        // --- BANCO DE PREGUNTAS (Tensiones de Acordes) ---
        const QUIZ_BANK = [
            {
                question: "¿Cuál es la tensión más común disponible en un acorde **Major 7** (Maj7), como Cmaj7?",
                options: ["b9", "9", "#11", "b13"],
                answer: "9",
                bonus: 600,
                feedback: "¡Correcto! La 9ª es la tensión por defecto que mejor suena en un acorde Maj7."
            },
            {
                question: "¿Qué tensión **debe evitarse** (avoid note) en un acorde **Dominante 7** (V7) si no está alterado?",
                options: ["9", "13", "#11", "b9"],
                answer: "#11",
                bonus: 800,
                feedback: "¡Genial! La #11 no se evita en un dominante 7, pero la 4ª (unísono con la 11ª) sí que es la avoid note más común si no está alterado." // Simplificando para el contexto Tetris: la #11 está asociada a Dominante Lydian.
            },
            {
                question: "En un acorde **Dominante Alterado** (por ejemplo, G7alt), ¿cuál de estas tensiones es **imprescindible** para darle su sonido 'alterado'?",
                options: ["9", "b9", "13", "11"],
                answer: "b9",
                bonus: 1000,
                feedback: "¡Excelente! Un dominante alterado suele incluir b9, #9, b5 o #5 (b13 o #11) para crear la máxima tensión."
            },
            {
                question: "¿Cuál es la tensión por excelencia que distingue a un acorde **Menor 7** (min7) de un acorde **Menor 6** (min6)?",
                options: ["b9", "11", "13", "b13"],
                answer: "11",
                bonus: 600,
                feedback: "¡Así es! La 11ª (perfecta) es la tensión por defecto para los acordes Min7 (aunque a menudo se omite la 9ª)."
            },
            {
                question: "Si utilizas la escala **Lydian Dominant** sobre un acorde V7, ¿qué tensión peculiar estás introduciendo?",
                options: ["b9", "#9", "#11", "b13"],
                answer: "#11",
                bonus: 1200,
                feedback: "¡Perfecto! El #11 es la nota característica del modo Lydian, que crea una dominante muy brillante."
            }
        ];
        let availableQuizzes = [...QUIZ_BANK];
        let currentQuiz = null;

        // --- FUNCIONES DE UTILIDAD ---

        function getRandomPiece() {
            const index = Math.floor(Math.random() * PIECES.length);
            const matrix = PIECES[index];
            const color = COLORS[index + 1];

            return {
                matrix,
                pos: { x: Math.floor(COLS / 2) - Math.floor(matrix[0].length / 2), y: 0 },
                color: color
            };
        }

        function createEmptyBoard() {
            return Array(ROWS).fill(null).map(() => Array(COLS).fill(0));
        }

        function drawBlock(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            ctx.strokeStyle = '#222';
            ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
        }

        function drawBoard() {
            // Dibuja el tablero fijo
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (board[y][x]) {
                        drawBlock(x, y, COLORS[board[y][x]]);
                    } else {
                        // Fondo del bloque
                        ctx.fillStyle = '#111';
                        ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
                    }
                }
            }
            
            // Dibuja la pieza actual
            if (currentPiece) {
                drawMatrix(currentPiece.matrix, currentPiece.pos);
            }
        }
        
        function drawMatrix(matrix, offset) {
            matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value) {
                        drawBlock(x + offset.x, y + offset.y, currentPiece.color);
                    }
                });
            });
        }

        function drawNextPiece() {
            nextPieceDisplay.innerHTML = '';
            
            if (!nextPiece) return;

            nextPiece.matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    const block = document.createElement('div');
                    block.classList.add('next-block');
                    if (value) {
                        block.style.backgroundColor = nextPiece.color;
                        block.style.border = '1px solid #000';
                        block.style.borderRadius = '2px';
                    }
                    // Posiciona correctamente en el grid 4x4
                    block.style.gridRow = y + 1;
                    block.style.gridColumn = x + 1;

                    nextPieceDisplay.appendChild(block);
                });
            });
        }

        function collide(board, piece) {
            const m = piece.matrix;
            const o = piece.pos;
            for (let y = 0; y < m.length; y++) {
                for (let x = 0; x < m[y].length; x++) {
                    if (m[y][x] !== 0 && (board[y + o.y] && board[y + o.y][x + o.x]) !== 0) {
                        return true;
                    }
                    if (m[y][x] !== 0 && (x + o.x < 0 || x + o.x >= COLS || y + o.y >= ROWS)) {
                        return true;
                    }
                }
            }
            return false;
        }

        function merge(board, piece) {
            piece.matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        board[y + piece.pos.y][x + piece.pos.x] = value;
                    }
                });
            });
        }

        function rotate(matrix, dir) {
            // Transponer la matriz
            for (let y = 0; y < matrix.length; ++y) {
                for (let x = 0; x < y; ++x) {
                    [matrix[x][y], matrix[y][x]] = [matrix[y][x], matrix[x][y]];
                }
            }
            // Invertir filas si es sentido horario (1) o columnas si es antihorario (-1)
            if (dir > 0) {
                matrix.forEach(row => row.reverse());
            } else {
                matrix.reverse();
            }
        }

        function pieceRotate() {
            if (!isPlaying || isQuizActive) return;

            const pos = currentPiece.pos.x;
            let offset = 1;
            rotate(currentPiece.matrix, 1); // Siempre rotamos en sentido horario

            // Corrección de patada (kick)
            while (collide(board, currentPiece)) {
                currentPiece.pos.x += offset;
                offset = -(offset + (offset > 0 ? 1 : -1)); // 1, -2, 3, -4, ...
                if (offset > currentPiece.matrix.length) {
                    rotate(currentPiece.matrix, -1); // Si no se puede, revierte la rotación
                    currentPiece.pos.x = pos; // Vuelve a la posición original
                    return;
                }
            }
        }

        function pieceDrop() {
            if (!isPlaying || isQuizActive) return;

            currentPiece.pos.y++;
            if (collide(board, currentPiece)) {
                currentPiece.pos.y--;
                merge(board, currentPiece);
                checkLines();
                newPiece();
            }
            dropCounter = 0;
        }

        function pieceMove(dir) {
            if (!isPlaying || isQuizActive) return;

            currentPiece.pos.x += dir;
            if (collide(board, currentPiece)) {
                currentPiece.pos.x -= dir;
            }
        }

        function checkLines() {
            let linesCleared = 0;

            outer: for (let y = ROWS - 1; y >= 0; --y) {
                for (let x = 0; x < COLS; ++x) {
                    if (board[y][x] === 0) {
                        continue outer; // Línea incompleta, pasa a la siguiente
                    }
                }

                // Línea completa
                const row = board.splice(y, 1)[0].fill(0); // Elimina la línea y crea una nueva vacía
                board.unshift(row); // Agrega la línea vacía al inicio
                y++; // Vuelve a verificar la misma fila
                linesCleared++;
            }

            if (linesCleared > 0) {
                updateScore(linesCleared);
                lines += linesCleared;
                linesElement.innerText = lines;
            }
        }

        function updateScore(linesCleared) {
            const scoreMultiplier = [0, 100, 300, 500, 800]; // Puntuación por 0, 1, 2, 3, 4 líneas
            const points = scoreMultiplier[linesCleared] || 0;
            score += points;
            
            // Actualiza el progreso del desafío
            challengeGoal -= points;
            if (challengeGoal <= 0) {
                challengeGoal = 0;
                startQuiz();
            }
            
            scoreElement.innerText = score;
            challengeProgressElement.innerText = `${500 - challengeGoal} / 500`;
            
            // Aumenta la velocidad ligeramente
            dropInterval = Math.max(100, INITIAL_SPEED - (lines * 20));
        }

        function newPiece() {
            currentPiece = nextPiece;
            nextPiece = getRandomPiece();
            drawNextPiece();

            // Fin del juego: si la nueva pieza colisiona inmediatamente
            if (collide(board, currentPiece)) {
                gameOver();
                return;
            }
            
            // Si el desafío de tensión está en 0, lo reiniciamos
            if (challengeGoal === 0 && !isQuizActive) {
                challengeGoal = 500;
                challengeProgressElement.innerText = `0 / 500`;
            }
        }

        function gameOver() {
            isPlaying = false;
            isQuizActive = false;
            startButton.innerText = `GAME OVER - Puntuación Final: ${score}`;
            startButton.classList.remove('bg-lime-500', 'hover:bg-lime-600');
            startButton.classList.add('bg-red-600', 'hover:bg-red-700');
            console.log("Juego Terminado. Puntuación: ", score);
        }

        // --- BUCLE PRINCIPAL Y ANIMACIÓN ---

        function update(time = 0) {
            if (!isPlaying || isQuizActive) {
                drawBoard(); // Asegura que se dibuje la última posición
                requestAnimationFrame(update);
                return;
            }

            const deltaTime = time - lastTime;
            lastTime = time;

            dropCounter += deltaTime;
            if (dropCounter > dropInterval) {
                pieceDrop();
            }

            drawBoard();
            requestAnimationFrame(update);
        }

        // --- QUIZ (DESAFÍO DE TENSIÓN) ---

        function startQuiz() {
            if (availableQuizzes.length === 0) {
                availableQuizzes = [...QUIZ_BANK]; // Recargar el banco si se agotó
            }
            
            const index = Math.floor(Math.random() * availableQuizzes.length);
            currentQuiz = availableQuizzes.splice(index, 1)[0];
            
            isQuizActive = true;
            
            quizQuestionElement.innerText = currentQuiz.question;
            quizOptionsElement.innerHTML = '';
            
            let selectedAnswer = null;

            // Mezcla y renderiza las opciones
            const shuffledOptions = currentQuiz.options.sort(() => Math.random() - 0.5);
            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('option-btn');
                button.innerText = option;
                button.addEventListener('click', () => {
                    document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedAnswer = option;
                });
                quizOptionsElement.appendChild(button);
            });

            quizSubmitButton.onclick = () => {
                if (selectedAnswer !== null) {
                    checkQuizAnswer(selectedAnswer);
                }
            };
            
            quizModal.classList.add('active');
        }

        function checkQuizAnswer(answer) {
            quizModal.classList.remove('active');
            isQuizActive = false;
            
            if (answer === currentQuiz.answer) {
                // Respuesta Correcta: ¡Gran Bonificación de Puntos!
                const bonus = currentQuiz.bonus;
                score += bonus;
                scoreElement.innerText = score;
                
                showFeedback(`🎉 ¡RESPUESTA CORRECTA! Bonificación de +${bonus} puntos. ${currentQuiz.feedback}`);

            } else {
                // Respuesta Incorrecta: No hay bonificación
                showFeedback(`❌ RESPUESTA INCORRECTA. La respuesta correcta era **${currentQuiz.answer}**. ¡A repasar!`, '#FF0000');
            }
            
            // Reiniciar el objetivo del desafío
            challengeGoal = 500; 
            challengeProgressElement.innerText = `0 / 500`;

            // Reanudar el juego
            lastTime = performance.now(); // Resetear el tiempo para evitar caídas inmediatas
            requestAnimationFrame(update);
        }
        
        function showFeedback(message, color = '#00FFD5') {
            const tempModal = document.createElement('div');
            tempModal.classList.add('modal', 'active');
            tempModal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            tempModal.innerHTML = `
                <div class="modal-content" style="border: 3px solid ${color};">
                    <h2 style="color: ${color};">${color === '#00FFD5' ? '¡ÉXITO ARMONICO!' : '¡ERROR ARMONICO!'}</h2>
                    <p style="color: #E0E0E0;">${message}</p>
                </div>
            `;
            document.body.appendChild(tempModal);
            
            setTimeout(() => {
                tempModal.classList.remove('active');
                setTimeout(() => tempModal.remove(), 300);
            }, 3000);
        }

        // --- GESTIÓN DE EVENTOS ---

        function setupControls() {
            document.addEventListener('keydown', (e) => {
                if (!isPlaying || isQuizActive) return;

                if (e.key === 'ArrowLeft') {
                    pieceMove(-1);
                } else if (e.key === 'ArrowRight') {
                    pieceMove(1);
                } else if (e.key === 'ArrowDown') {
                    pieceDrop();
                } else if (e.key === 'ArrowUp' || e.key === 'r' || e.key === 'R') {
                    pieceRotate();
                }
            });
            
            // Controles móviles (touch/click)
            document.querySelectorAll('.control-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const action = e.currentTarget.dataset.action;
                    if (!isPlaying || isQuizActive) return;

                    if (action === 'left') pieceMove(-1);
                    else if (action === 'right') pieceMove(1);
                    else if (action === 'down') pieceDrop();
                    else if (action === 'rotate') pieceRotate();
                });
            });
            
            // Botón de Inicio
            startButton.addEventListener('click', initGame);
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !isPlaying) {
                    initGame();
                }
            });
        }

        // --- INICIALIZACIÓN ---
        
        function initGame() {
            if (isPlaying) return;

            // Resetear estado
            board = createEmptyBoard();
            score = 0;
            lines = 0;
            challengeGoal = 500;
            availableQuizzes = [...QUIZ_BANK];
            
            scoreElement.innerText = score;
            linesElement.innerText = lines;
            challengeProgressElement.innerText = `0 / 500`;
            
            startButton.innerText = 'JUGANDO...';
            startButton.classList.remove('bg-red-600', 'hover:bg-red-700');
            startButton.classList.add('bg-lime-500', 'hover:bg-lime-600');
            
            nextPiece = getRandomPiece();
            newPiece();

            isPlaying = true;
            lastTime = performance.now();
            update();
        }

        setupControls();
        drawBoard(); // Dibuja el tablero inicial vacío
        
    </script>
</body>
</html>